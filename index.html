<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global eInvoicing Program Status</title>
  <link rel="stylesheet" href="index-styles.css">
</head>
<body>

  <nav class="top-bar">
    <div class="top-bar-left">
      <span class="top-bar-title">Global eInvoicing</span>
      <span class="top-bar-subtitle">Program Status</span>
    </div>
    <div class="top-bar-right">
      <select id="report-picker" class="report-picker">
        <option value="">Loading...</option>
      </select>
    </div>
  </nav>

  <iframe id="report-frame" class="report-frame"></iframe>

  <script>
    (async function () {
      const picker = document.getElementById('report-picker');
      const frame = document.getElementById('report-frame');
      const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

      try {
        const res = await fetch('manifest.json');
        if (!res.ok) throw new Error('Failed to load manifest');
        const data = await res.json();

        if (!data.reports || data.reports.length === 0) {
          picker.innerHTML = '<option value="">No reports</option>';
          return;
        }

        picker.innerHTML = data.reports.map(function (r, i) {
          var parts = r.date.split('-');
          var d = new Date(+parts[0], +parts[1] - 1, +parts[2]);
          var day = weekdays[d.getDay()];
          var label = r.title + ' (' + day + ')';
          if (i === 0) label = label + ' — Latest';
          return '<option value="reports/' + r.date + '.html">' + label + '</option>';
        }).join('');

        // Load latest report
        frame.src = picker.value;
        document.title = 'Program Status — ' + data.reports[0].title;

        picker.addEventListener('change', function () {
          frame.src = picker.value;
          var idx = picker.selectedIndex;
          document.title = 'Program Status — ' + data.reports[idx].title;
        });
      } catch (e) {
        picker.innerHTML = '<option value="">Error loading reports</option>';
      }
    })();
  </script>

</body>
</html>
